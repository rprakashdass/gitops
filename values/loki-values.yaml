# No PSP (removed in K8s 1.25) or SCC (OpenShift-only); skip chart RBAC and use default SA
rbac:
  create: false

# Disable memcached caches (no memcached deployed) to avoid SRV lookup errors
chunksCache:
  enabled: false
resultsCache:
  enabled: false

ruler:
  enabled: false

write:
  initContainers:
    - name: fix-perms
      image: busybox:1.36
      command:
        - sh
        - -c
        - |
          mkdir -p /var/loki
          chown -R 10001:10001 /var/loki
          chmod -R u+rwX,g+rwX /var/loki
      securityContext:
        runAsUser: 0
        runAsGroup: 0
      volumeMounts:
        - name: data
          mountPath: /var/loki

backend:
  initContainers:
    - name: fix-perms
      image: busybox:1.36
      command:
        - sh
        - -c
        - |
          mkdir -p /var/loki
          chown -R 10001:10001 /var/loki
          chmod -R u+rwX,g+rwX /var/loki
      securityContext:
        runAsUser: 0
        runAsGroup: 0
      volumeMounts:
        - name: data
          mountPath: /var/loki
loki:
  # So /var/loki (tsdb-shipper) is writable by Loki user 10001
  podSecurityContext:
    fsGroup: 10001

  storage:
    type: s3
    bucketNames:
      chunks: loki-chunks
      ruler: loki-ruler
      admin: loki-admin
    s3:
      endpoint: http://minio.monitoring.svc.cluster.local:9000
      accessKeyId: loki
      secretAccessKey: loki12345
      s3ForcePathStyle: true
      insecure: true

  # Required: schema_config for index/object store (S3)
  schemaConfig:
    configs:
      - from: "2020-10-24"
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: index_
          period: 24h