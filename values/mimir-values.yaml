# No PSP (removed in K8s 1.25) or SCC (OpenShift-only); skip chart RBAC and use default SA
rbac:
  create: false

kafka:
  enabled: false
minio:
  enabled: false
ruler:
  enabled: false
alertmanager:
  enabled: false
zoneAwareReplication:
  enabled: false

gateway:
  enabled: true

# Use minikube standard hostpath storage
ingester:
  replicas: 1
  persistentVolume:
    enabled: true
    storageClass: standard
    size: 10Gi
  extraEnv:
    - name: POD_IP
      valueFrom:
        fieldRef: { fieldPath: status.podIP }

store_gateway:
  replicas: 1
  persistentVolume:
    enabled: true
    storageClass: standard
    size: 10Gi
  extraEnv:
    - name: POD_IP
      valueFrom:
        fieldRef: { fieldPath: status.podIP }

distributor:
  replicas: 1
  extraEnv:
    - name: POD_IP
      valueFrom:
        fieldRef: { fieldPath: status.podIP }

querier:
  replicas: 1
  extraEnv:
    - name: POD_IP
      valueFrom:
        fieldRef: { fieldPath: status.podIP }

query_frontend:
  replicas: 1
  extraEnv:
    - name: POD_IP
      valueFrom:
        fieldRef: { fieldPath: status.podIP }

# If chart enables query-scheduler (often does), ensure it won’t try eth0/en0 auto-detect
query_scheduler:
  replicas: 1
  extraEnv:
    - name: POD_IP
      valueFrom:
        fieldRef: { fieldPath: status.podIP }

mimir:
  structuredConfig:
    storage:
      backend: filesystem

    blocks_storage:
      backend: filesystem
      filesystem:
        dir: /data/tsdb

    # Prevent “no useable address found for interfaces [eth0 en0]”
    distributor:
      ring:
        instance_addr: ${POD_IP}
        instance_id: ${HOSTNAME}

    ingester:
      ring:
        instance_addr: ${POD_IP}
        instance_id: ${HOSTNAME}

    store_gateway:
      sharding_ring:
        instance_addr: ${POD_IP}
        instance_id: ${HOSTNAME}

    frontend:
      scheduler_address: "mimir-query-scheduler-headless.monitoring.svc.cluster.local.:9095"
    frontend_worker:
      scheduler_address: "mimir-query-scheduler-headless.monitoring.svc.cluster.local.:9095"